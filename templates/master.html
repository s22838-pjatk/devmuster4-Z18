<!doctype html >
<html>
<head>
    <meta charset="UTF-8">
    <title>Ścieżka Master</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/w3.css">
    <link rel="stylesheet" href="/static/index.css" type="text/css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/fontawesome.min.js"></script>
    <style>
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }
      td{
        color:rgba(0,0,0,0);
      }
        body, html {
          height: 100%;
          margin: 0;
          color:white;
          font-family: "Changa";
        }
        .speech-bubble {
        	position: relative;
          background: rgba(0,0,0,0.5);
        	border-radius: .4em;
        }

        .round_corners{
          border-radius: 50px;
        }
        @-webkit-keyframes rotating /* Safari and Chrome */ {
          from {
            -webkit-transform: rotate(0deg);
            -o-transform: rotate(0deg);
            transform: rotate(0deg);
          }
          to {
            -webkit-transform: rotate(360deg);
            -o-transform: rotate(360deg);
            transform: rotate(360deg);
          }
        }
        @keyframes rotating {
          from {
            -ms-transform: rotate(0deg);
            -moz-transform: rotate(0deg);
            -webkit-transform: rotate(0deg);
            -o-transform: rotate(0deg);
            transform: rotate(0deg);
          }
          to {
            -ms-transform: rotate(360deg);
            -moz-transform: rotate(360deg);
            -webkit-transform: rotate(360deg);
            -o-transform: rotate(360deg);
            transform: rotate(360deg);
          }
        }
        .rotating {
          -webkit-animation: rotating 2s linear infinite;
          -moz-animation: rotating 2s linear infinite;
          -ms-animation: rotating 2s linear infinite;
          -o-animation: rotating 2s linear infinite;
          animation: rotating 2s linear infinite;
        }
        #playstop {
          cursor: pointer;
        }
        </style>


</head>
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
<body style="background-image: linear-gradient(#AA0099, #990000);">


<div class="w3-main" id="main" style="opacity:0; position: absolute; top:0;left:0; width:100%;height:100%;overflow:auto">

  <div class="w3-right w3-quarter">
    <h1 class="w3-center"><b>Pan DJ</b></h1>
    <p id="character" class="w3-center"><img src="/static/charactermini-512.png" style="padding:16px; width:100%" alt="Character"></p><br>
    <p id="playstop" class="w3-center"><img src="/static/playstop-256.png" style="padding:16px; width:186px" alt="Play/Stop">
  </div>
<div class="w3-center w3-threequarter">
  <div class="w3-content w3-padding-16 speech-bubble" style="color:white; overflow: auto; padding-left: 32px; padding-right:32px; max-height:85vh; margin-top:5%">
    <div>
      <h4>Ścieżka Master użytkownika {{username}}</h4>
    </div>
    <div id="bubble">
    {% for t in tracks %}
    <div class="w3-container w3-center w3-padding-16" style="margin-right: 25px; margin-left: 25px; padding-right:56px; position: relative; background-image: linear-gradient(45deg, #642B09, #842A04, #331800);">
      <div class="w3-content">
        <div class-"w3-left"><img class="rotating" src="/static/roll-256.png" style="position: absolute; width:110px; left:-55px; top:-5px" alt="Tape"></div>
        <div class="w3-center" style="padding-left:56px"><a style="display:inline-block; font-size: 20px">{{t[1]}}</a></div>
        <div class="w3-center">
          <a href="/del_track?no={{t[0]}}" class="w3-right" style="display: inline-block; margin-left:5px;"><img style="height:36px" src=/static/trashcan.png>&nbsp;&nbsp;</img></a>
          <div id="track_edit{{t[0]}}" class="w3-right" style="display: inline-block; margin-left:5px;"><img style="height:36px" src=/static/editicon.png></img>&nbsp;&nbsp;</div>
          <div class="w3-right" style="display: inline-block; margin-left:5px;"><img style="height:36px" src=/static/muteicon.png>&nbsp;&nbsp;</img></div>
        </div>
        <div class-"w3-right" style="display: inline-block"><img class="rotating" src="/static/roll-256.png" style="position: absolute; width:110px; right:-55px; top:-5px" alt="Tape"></div>
      </div>
    </div><br><br>
    {% endfor %}
    <br>
    <a href="/new_track" class="w3-center round_corners w3-white w3-button">Nowa taśma</a>
    </div>
    <div id="edit" style="display:none">
      <table style="width:100%; height:100%">
      <tr>
        {% for n in range(8) %}
        <th id="th{{n}}">{{n}}</th>
        {% endfor %}
      </tr>
        {% for m in range(8) %}
      <tr id="tr{{n}}">
        {% for n in range(8) %}
        <td id="td{{n}}_{{m}}">{{m}}/{{n}}</td>
        {% endfor %}
      </tr>
        {% endfor %}
    </table>
    <br>
    <a id="go_back" class="w3-center round_corners w3-white w3-button">Wróć</a>
    </div>
  </div>
</div>


</div>
<script>
var current_track = 0;
var pattern = [{% for t in tracks %}{{t[3]}}, {% endfor %}];
track_length = 16;
console.log(pattern);
var stop = false;
var row = 0;
function player() {
  if(stop != 1){
  for(i=0;i<8;i++){
    console.log($('#td' + row.toString()+"_"+i.toString()).css("background-color"));
    if($('#td' + row.toString()+"_"+i.toString()).css("background-color")=="rgb(255, 0, 0)"){
        var audio = new Audio('/static/'+row+'.wav');
        audio.play();
      };
    };
  }''
  row+= 1;
  if(row==8){
    row=0;
  }
}
var player_start = setInterval(player, 100);
$(document).ready(function() {
  $("#main").animate({opacity: 1});
});
{% for t in tracks %}
$("#track_edit{{t[0]}}").click(function() {
  current_track = {{t[0]}};
  $("#bubble").css({'display': 'none'});
  $("#edit").css({'display': 'block'});
  for(i=0;i<pattern[current_track-1].length; i++){
    $("#td"+pattern[current_track-1][i][0]+"_"+pattern[current_track-1][i][1]).css({"background-color": "red"});
  }
});
$("#playstop").unbind().click(function() {
  stop = !stop;
  console.log(stop);
});

{% endfor %}
$("#go_back").click(function() {
  current_track = 0;
  $("#bubble").css({'display': 'block'});
  $("#edit").css({'display': 'none'});
});
$("td").click(function() {
    var item = $(this).closest("td").text();
});
</script>

</html>
